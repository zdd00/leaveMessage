<?phpnamespace app\index\controller;use think\Controller;use think\Db;use think\db\exception\DataNotFoundException;use think\db\exception\ModelNotFoundException;use think\exception\DbException;class Report extends Controller{    public function index()    {        try {            $list = Db::name('userInfo')->order('time desc')->paginate(50);        } catch (DataNotFoundException $e) {        } catch (ModelNotFoundException $e) {        } catch (DbException $e) {        }        $this->assign('list',$list);        return $this->fetch('index');    }    public function out(){        $path = dirname(__FILE__);        vendor("PHPExcel.PHPExcel");        vendor("PHPExcel.PHPExcel.Writer.Excel5");        vendor("PHPExcel.PHPExcel.Writer.Excel2007");        vendor("PHPExcel.PHPExcel.IOFactory");        $objPHPExcel = new \PHPExcel();        $objWriter = new \PHPExcel_Writer_Excel5($objPHPExcel);        $objWriter = new \PHPExcel_Writer_Excel2007($objPHPExcel);        $param = request()->param();        try {            if($param['order']){                $sql = db('userInfo')->order('time')->select();            }else{                $sql = db('userInfo')->order('time desc')->select();            }        } catch (DataNotFoundException $e) {        } catch (ModelNotFoundException $e) {        } catch (DbException $e) {        }        try {            $objPHPExcel->setActiveSheetIndex(0)                ->setCellValue('A1', 'ID')                ->setCellValue('B1', '用户名')                ->setCellValue('C1', '手机号')                ->setCellValue('D1', '提交时间')                ->setCellValue('E1', '来源');            $objPHPExcel->getActiveSheet()->getColumnDimension('A')->setWidth(6);            $objPHPExcel->getActiveSheet()->getColumnDimension('B')->setWidth();            $objPHPExcel->getActiveSheet()->getColumnDimension('C')->setWidth(12);            $objPHPExcel->getActiveSheet()->getColumnDimension('D')->setWidth(20);            $objPHPExcel->getActiveSheet()->getColumnDimension('E')->setWidth(40);        } catch (\PHPExcel_Exception $e) {        }        /*--------------开始从数据库提取信息插入Excel表中------------------*/        //$i=2;  //定义一个i变量，目的是在循环输出数据是控制行数        $count = count($sql);  //计算有多少条数据        for ($i = 2; $i <= $count+1; $i++) {            try {                $objPHPExcel->getActiveSheet()->setCellValue('A' . $i, $sql[$i - 2]['id']);                $objPHPExcel->getActiveSheet()->setCellValue('B' . $i, $sql[$i-2]['name']);                $objPHPExcel->getActiveSheet()->setCellValue('C' . $i, $sql[$i-2]['phone']);                $objPHPExcel->getActiveSheet()->setCellValue('D' . $i, $sql[$i-2]['time']);                $objPHPExcel->getActiveSheet()->setCellValue('E' . $i, $sql[$i-2]['source']);            } catch (\PHPExcel_Exception $e) {            }        }        /*--------------下面是设置其他信息------------------*/        ob_end_clean();        try {            $objPHPExcel->getActiveSheet()->setTitle('信息');        } catch (\PHPExcel_Exception $e) {        }      //设置sheet的名称        try {            $objPHPExcel->setActiveSheetIndex(0);        } catch (\PHPExcel_Exception $e) {        }                   //设置sheet的起始位置        try {            $objWriter = \PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');        } catch (\PHPExcel_Reader_Exception $e) {        }   //通过PHPExcel_IOFactory的写函数将上面数据写出来        try {            $PHPWriter = \PHPExcel_IOFactory::createWriter($objPHPExcel, "Excel2007");        } catch (\PHPExcel_Reader_Exception $e) {        }        $filename ="用户信息.xlsx";        iconv('utf-8', 'gb2312', $filename);        header('content-Type:application/vnd.ms-excel;charset=utf-8');        header('Content-Disposition: attachment;filename='.$filename);        header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');        try {            $PHPWriter->save("php://output");        } catch (\PHPExcel_Writer_Exception $e) {        } //表示在$path路径下面生成demo.xlsx文件    }}